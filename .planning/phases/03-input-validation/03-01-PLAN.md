---
phase: 03-input-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skill/SKILL.md
autonomous: true

must_haves:
  truths:
    - "Invalid path produces specific error with exact path shown"
    - "Missing README produces guidance linking to Gate 4 requirement"
    - "Permission denied error suggests chmod fix"
    - "File-instead-of-directory error suggests parent directory"
    - "Empty directory (no project files) produces list of expected indicators"
  artifacts:
    - path: "skill/SKILL.md"
      provides: "Input validation section with 6-stage validation flow"
      contains: "## Input Validation"
  key_links:
    - from: "skill/SKILL.md validation section"
      to: "guides/INPUT-VALIDATION.md"
      via: "reference link"
      pattern: "guides/INPUT-VALIDATION\\.md"
---

<objective>
Add input validation to SKILL.md with a 6-stage pre-audit validation flow.

Purpose: Users currently get cryptic errors or nonsense reports when providing invalid paths, missing READMEs, or empty directories. This plan adds explicit validation that catches bad input early and provides actionable error messages.

Output: Updated SKILL.md with "Input Validation" section containing the validation protocol and error message patterns.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-input-validation/03-RESEARCH.md

@skill/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Input Validation section to SKILL.md</name>
  <files>skill/SKILL.md</files>
  <action>
Add a new section "## Input Validation" immediately after the "## Usage" section in SKILL.md. This section defines the pre-audit validation protocol.

The section should include:

1. **Validation Flow** (6 stages, executed in order, stop at first failure):
   - Stage 1: Normalize path (handle ~/, relative paths, trailing slashes)
   - Stage 2: Check path exists
   - Stage 3: Check path is a directory (not a file)
   - Stage 4: Check README.md exists and is readable
   - Stage 5: Check for project indicators (at least one of: package.json, Cargo.toml, pyproject.toml, go.mod, src/, lib/, index.js, main.py)
   - Stage 6: Proceed to audit

2. **Error Message Format** (three-part structure for all errors):
   ```
   X Cannot audit: {Problem}

     Why this matters:
       {Link to specific gate requirement}

     Fix this by:
       {Actionable steps}
   ```

3. **Error Types and Messages** (one for each validation failure):

   **Path does not exist:**
   ```
   X Cannot audit: Path does not exist
     Path: /bad/path

     Why this matters:
       Cannot read project files without a valid path.

     Fix this by:
       Check the path and try again.
   ```

   **Not a directory:**
   ```
   X Cannot audit: Path is a file, not a directory
     Path: /path/to/README.md

     Why this matters:
       Audit requires a project directory, not a single file.

     Fix this by:
       Provide the directory containing your project.
       Try: /rfu-audit /path/to
   ```

   **Permission denied:**
   ```
   X Cannot audit: Permission denied
     Path: /restricted/path

     Why this matters:
       Cannot read project files without read access.

     Fix this by:
       Grant read access: chmod +r /restricted/path
       Or run from a directory you have access to.
   ```

   **Missing README:**
   ```
   X Cannot audit: No README.md found
     Path: /path/to/project

     Why this matters:
       Gate 4 (Bartender Test) requires a clear value statement,
       which should be in README.md.

     Fix this by:
       Create README.md with:
       1. What this project does (one sentence)
       2. Installation instructions
       3. Basic usage example
   ```

   **No project files:**
   ```
   X Cannot audit: No project files detected
     Path: /path/to/empty

     Why this matters:
       Gate 3 (10-Minute Test) requires working code to evaluate.

     Fix this by:
       Ensure directory contains source code and configuration.
       Expected indicators: package.json, Cargo.toml, pyproject.toml,
       go.mod, src/, lib/, or entry files (index.js, main.py)
   ```

4. **Reference to guide:**
   Add note: "For complete error handling patterns, see `guides/INPUT-VALIDATION.md`."

Keep the section concise but complete. The guide will have the full implementation details.
  </action>
  <verify>
Read skill/SKILL.md and confirm:
- "## Input Validation" section exists after "## Usage"
- 6-stage validation flow is documented
- All 5 error types have specific message templates
- Reference to guides/INPUT-VALIDATION.md exists
  </verify>
  <done>
SKILL.md contains Input Validation section with complete validation protocol and all error message templates.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Process section to reference validation</name>
  <files>skill/SKILL.md</files>
  <action>
Update the existing "## Process" section to make validation explicit as step 0.

Current process starts with:
1. Read project files: README, package.json, main source files

Change to:
0. **Validate input**: Run 6-stage validation (see Input Validation section)
1. **Read project files**: README, package.json, main source files
... (rest unchanged)

This makes it clear that validation happens BEFORE any project reading.
  </action>
  <verify>
Read skill/SKILL.md Process section and confirm:
- Step 0 exists with "Validate input" as first action
- References Input Validation section
- Original steps renumbered (1-6 become 1-6, with validation as step 0)
  </verify>
  <done>
Process section explicitly includes validation as the first step, ensuring bad input is caught before any audit work begins.
  </done>
</task>

</tasks>

<verification>
After completing both tasks:
1. Read full SKILL.md to verify section ordering: Usage -> Input Validation -> The 11 Gates...
2. Confirm error message format is consistent across all 5 error types
3. Confirm Process section starts with validation step
4. Confirm reference to guides/INPUT-VALIDATION.md exists
</verification>

<success_criteria>
- SKILL.md has Input Validation section immediately after Usage
- All 5 error types (path not exist, not directory, permission denied, no README, no project files) have specific templates
- Process section lists validation as step 0
- Guide reference points to guides/INPUT-VALIDATION.md
</success_criteria>

<output>
After completion, create `.planning/phases/03-input-validation/03-01-SUMMARY.md`
</output>
